title: 从BT下载开讲-1
tags:
  - DHT
  - 哈希
  - 文件
  - 贡献
  - BT
  - P2P
categories:
  - 爱学习
copyright: true
author: CYF
date: 2020-04-07 14:17:45
---
# Bittorrent：分布式哈希表技术

## 先来一个故事

很久很久以前，有一位老头，叫做刘XX。

他是一位很有资格的老师，为了顽固学生们的学习效果，他发送给所有学生一部视频：

![图片](https://img.cyfan.top/pic/BT/视频.bmp "大视频")

（注：老刘的带宽是8Mbps，即最大带宽1MB/s，每一个学生的带宽也是8Mbps）

我们假设有5位学生需要这部视频，则可以画这样一幅图：

![图片](https://img.cyfan.top/pic/BT/down1.png "组团下载ing...")

这只视频是`88.8MB`大小,按照这样的速度,同学需要花费`1024*88.8MB/(204.8kb/s)=444s`即`7分钟24秒`

这还往往只是最理想状况.现在,我们来假设一下现象的出现:

1. 由于视频过于好看,引起广泛关注.现在有200个同学要求下载.则单个人下载完需要17760s即296min也就是约5h!
2. 刘老师觉得单个视频教学质量不够好,决定上传一个8880GB的超大视频.(下载时间大于一天)
3. 几个同学与刘老师搞好了关系,刘老师给他们较高的下载速度,导致带宽分配不均匀,没有关系的学生下载速度更慢了.(百度网盘既视感)

![图片](https://img.cyfan.top/pic/BT/down-VIP.png "A1拥有VIP专线")

4. 由于刘老师给的视频过于激烈,在下载了一段时间后,FBI```open the door!```敲上门来带走了刘老师,视频被查封了!!!(下载速度0)

![图片](https://img.cyfan.top/pic/BT/FBI.jpeg "FBI！Open the door！")

可是，学习是必须的，这可怎么办呢？？？

这时....

刘老师突然想起来，为什么不让每一个学生互相连接，贡献自己已经下好的部分，以来获得最大的下载速度呢？？

请注意，在上述下载中，每一个人都没有充分利用自己的最大带宽，对不对？

那，解决办法就来了:

## P2P：

以256KB为包，我们就可获得356块文件

![图片](https://img.cyfan.top/pic/BT/file.png "分包")

回到下载界面，我们看到，所有人都与其他人获得连接，那么，连接完成后：

![图片](https://img.cyfan.top/pic/BT/down-each.png "连接")

（为了方便观察，我们将不必要的连接全部去掉）

现在，我们重新开始下载：

我们假设，A1下载了第一块，A2下载了第二块...

两秒后，所有人手上都拥有了一块文件：

![图片](https://img.cyfan.top/pic/BT/down-part1.png "下载")

接下来，在不影响下载的情况下，A1与A2交换下载好的部分，同时与A3、A4、A5交换

![图片](https://img.cyfan.top/pic/BT/down-part2.png "贡献&下载")

看到了吗，所有人都得到了更高的速度，所有人的带宽都得到了最充分的利用。

接着4秒后，所有的贡献分块都下载好了，而每一个人都从文件发布者身上又得到新的文件碎片。

![图片](https://img.cyfan.top/pic/BT/down-part3.png "下载！")

所以，这种情况回一直持续下去，直到每一个人都下载完成，每一个人都只需下载149秒即2分29秒！相对于单点时间大大减少！

![图片](https://img.cyfan.top/pic/BT/down-finish.png "完整！")

## 人数多&文件大 问题

现在，我们来假设第一个问题，200人下载怎么办？

我们可以明白，人数越多，文件交换越密集，对不对？

显然会见的，这个问题显得异常白痴，可以体会的是，在最佳条件下，每个人的带宽都达到了最大，如果每个人都下载了不同的分块，同时每个人都在贡献。

那么，每个人的下载速度，根本不会受到很大影响。

这对于传统下载（http/https/ftp）不同，传统下载仅仅由一台服务器贡献，人数多对于这台服务器压力极大。

但是，在这个环境里，服务器不仅仅是一台，而且，每当加入一个人，每一个人都可以当作服务器，这样，下载速度反而会大大提升。

反而文件很大是个硬梗，不过相对于传统下载，这种下载方式还是有一定能力解决这个问题的。

**但是**，这里还有几个问题没有解决：

<未完待续>